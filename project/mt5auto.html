<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conception d'un Moteur d'Auto-Apprentissage Adaptatif pour MT5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Gris clair neutre */
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .nav-link {
            padding: 12px 18px;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #d1d5db; 
            border-left: 4px solid transparent;
        }
        .nav-link:hover {
            background-color: #374151;
            color: #ffffff;
            border-left-color: #60a5fa;
        }
        .nav-link.active {
            background-color: #1e40af;
            color: #ffffff;
            font-weight: 600;
            border-left-color: #2563eb;
            box-shadow: 0 4px 14px rgba(30, 64, 175, 0.2);
        }
        .nav-link.font-semibold.active { 
             background-color: #1d4ed8; 
        }
        .nav-link.ml-4.active { 
            background-color: #2563eb; 
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 6px 12px -2px rgba(0, 0, 0, 0.05), 0 3px 7px -3px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        th, td {
            border-bottom: 1px solid #e5e7eb;
            padding: 14px 18px;
            text-align: left;
            font-size: 0.925rem;
        }
        th {
            background-color: #f9fafb;
            font-weight: 600;
            color: #111827;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        td {
            background-color: #ffffff;
            color: #374151;
        }
        tr:last-child td {
            border-bottom: none;
        }
        tr:hover td {
            background-color: #f8f9fa;
        }
        .table-container {
            overflow-x: auto;
        }
        .code-block {
            background-color: #1f2937; 
            color: #d1d5db; 
            padding: 1.5rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-family: 'JetBrains Mono', 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            font-size: 0.875rem; 
            margin-top: 1rem;
            margin-bottom: 1rem;
            border: 1px solid #374151;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }
        .code-block pre {
            margin: 0;
            white-space: pre-wrap;
            word-break: break-all;
        }
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #e5e7eb;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #9ca3af;
            border-radius: 10px;
            border: 2px solid #e5e7eb;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        
        .content-card {
            background-color: #ffffff;
            padding: 2.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.08), 0 8px 10px -6px rgba(0, 0, 0, 0.08);
            margin-bottom: 2.5rem;
        }
        h2.section-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 2rem;
            color: #1e3a8a;
            border-bottom: 3px solid #3b82f6;
            padding-bottom: 0.75rem;
            letter-spacing: -0.025em;
        }
         h3.subsection-title {
            font-size: 1.875rem;
            font-weight: 700;
            margin-top: 2rem;
            margin-bottom: 1.25rem;
            color: #1d4ed8;
        }
         h4.block-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1.75rem;
            margin-bottom: 1rem;
            color: #1e40af;
        }
        ul.styled-list {
            list-style: none;
            padding-left: 0;
        }
        ul.styled-list > li {
            position: relative;
            padding-left: 2rem;
            margin-bottom: 0.75rem;
            color: #4b5563;
            line-height: 1.6;
        }
        ul.styled-list > li::before {
            content: "\f058"; 
            font-family: "Font Awesome 6 Free";
            font-weight: 900; 
            position: absolute;
            left: 0;
            top: 5px;
            color: #2563eb;
            font-size: 1rem;
        }
        ul.styled-list ul { 
            margin-top: 0.5rem;
            padding-left: 1.25rem; 
        }
        ul.styled-list ul > li::before {
            content: "\f101"; 
            font-size: 0.875rem; 
        }

        .page-break { page-break-after: always; }
        /* Styles d'impression simples */
        @media print {
            body { font-size: 10pt; line-height: 1.2; background-color: #ffffff !important; }
            aside { display: none !important; }
            main { margin-left: 0 !important; padding: 1cm !important; overflow-y: visible !important; }
            .content-section { display: block !important; margin-bottom: 2cm; }
            h1, h2, h3, h4, h5, h6 { page-break-after: avoid; page-break-inside: avoid; color: #000 !important; }
            table, figure, .code-block { page-break-inside: avoid; }
            .content-card { background-color: transparent !important; color: #000 !important; border: 1px solid #ccc !important; box-shadow: none !important; border-radius: 0 !important; padding: 1cm;}
            .nav-link { display: none !important; }
            .table-container { overflow-x: visible; }
            .code-block { background-color: #f0f0f0 !important; color: #000 !important; border: 1px solid #ccc !important;}
            ul.styled-list > li::before { color: #000 !important; }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">
    <div class="flex min-h-screen">
        <aside class="w-80 bg-slate-900 text-slate-100 p-6 space-y-2.5 fixed top-0 left-0 h-full overflow-y-auto print:hidden shadow-2xl">
            <h1 class="text-2xl font-extrabold mb-10 text-blue-400 tracking-tight">Moteur d'Auto-Apprentissage MT5</h1>
            <nav id="report-navigation" class="space-y-1.5">
                <a href="#" class="nav-link block" data-target="executive-summary">1. Résumé Exécutif</a>
                <a href="#" class="nav-link block font-semibold" data-target="architectural-blueprint">2. Blueprint Architectural</a>
                <a href="#" class="nav-link block ml-4" data-target="system-overview">2.1. Vue d'Ensemble & Logique</a>
                <a href="#" class="nav-link block ml-4" data-target="key-modules">2.2. Modules Clés & Interactions</a>
                <a href="#" class="nav-link block font-semibold" data-target="core-components">3. Composants Système Clés</a>
                <a href="#" class="nav-link block ml-4" data-target="mt5-interface">3.1. Interface avec MT5 via Python</a>
                <a href="#" class="nav-link block ml-4" data-target="data-persistence">3.2. Persistance des Données</a>
                <a href="#" class="nav-link block ml-4" data-target="incremental-learning">3.3. Réentraînement Incrémental (CatBoost)</a>
                <a href="#" class="nav-link block ml-4" data-target="automation-scheduler">3.4. Automatisation (Planificateur Windows)</a>
                <a href="#" class="nav-link block font-semibold" data-target="adaptability-resilience">4. Adaptabilité et Résilience</a>
                <a href="#" class="nav-link block ml-4" data-target="concept-drift">4.1. Détection de Dérive de Concept</a>
                <a href="#" class="nav-link block ml-4" data-target="model-rollback">4.2. Stratégie de Rollback Modèle</a>
                <a href="#" class="nav-link block" data-target="performance-analysis-gpu">5. Analyse de Performance (GPU vs CPU)</a>
                <a href="#" class="nav-link block" data-target="conclusion-engine">6. Conclusion et Perspectives</a>
                <a href="#" class="nav-link block" data-target="references-engine">7. Références</a>
            </nav>
        </aside>

        <main class="flex-1 ml-80 p-6 sm:p-8 md:p-12 overflow-y-auto">
            
            <section id="executive-summary" class="content-section active">
                <div class="content-card">
                    <h2 class="section-title">1. Résumé Exécutif</h2>
                    <p class="mb-4 text-slate-700 leading-relaxed text-lg">
                        <strong>Objectif :</strong> Ce document présente une conception complète pour un moteur d'apprentissage automatisé et adaptatif, spécifiquement adapté aux applications de trading algorithmique. L'objectif principal est de décrire un système capable d'auto-amélioration continue et d'adaptation dans l'environnement hautement dynamique des marchés financiers.
                    </p>
                    <p class="mb-4 text-slate-700 leading-relaxed text-lg">
                        <strong>Concept Clé :</strong> L'architecture du moteur repose sur le principe de l'adaptation continue aux conditions de marché évolutives. Ceci est réalisé grâce à une combinaison synergique de méthodologies d'apprentissage incrémental, d'un mécanisme robuste de boucle de rétroaction, et de stratégies proactives de maintenance des modèles, incluant la détection de dérive de concept et des capacités de rollback de modèle.
                    </p>
                    <h3 class="subsection-title">Composants Clés :</h3>
                    <ul class="styled-list">
                        <li>Traitement initial des signaux.</li>
                        <li>Utilisation de la plateforme MetaTrader 5 (MT5) pour l'exécution d'ordres de démonstration.</li>
                        <li>Journalisation complète des données (SQLite, CSV) pour audit et réentraînement.</li>
                        <li>Bibliothèque CatBoost pour ses capacités de réentraînement incrémental (fonctionnalité <code>init_model</code>).</li>
                        <li>Planificateur de tâches Windows pour l'orchestration.</li>
                        <li>Algorithmes de détection de dérive de concept.</li>
                        <li>Procédures de rollback de modèle.</li>
                    </ul>
                    <p class="mt-4 text-slate-700 leading-relaxed text-lg">
                        <strong>Bénéfices :</strong> Pertinence améliorée des modèles, utilisation efficace des ressources, résilience accrue du système de trading.
                    </p>
                     <p class="mt-4 text-slate-700 leading-relaxed text-lg">
                        <strong>Public Cible :</strong> Développeurs quantitatifs, ingénieurs en machine learning, data scientists financiers.
                    </p>
                </div>
            </section>

            <section id="architectural-blueprint" class="content-section page-break">
                <div class="content-card">
                    <h2 class="section-title">2. Blueprint Architectural du Moteur d'Auto-Apprentissage</h2>
                </div>
            </section>

            <section id="system-overview" class="content-section">
                <div class="content-card">
                    <h3 class="subsection-title">2.1. Vue d'Ensemble du Système et Logique</h3>
                    <p class="mb-4 text-slate-700 leading-relaxed">
                        Le moteur d'auto-apprentissage proposé est conçu comme un système cyclique, assurant une adaptation et un apprentissage continus. Le flux général est le suivant :
                    </p>
                    <ol class="list-decimal list-inside space-y-2 mb-4 text-slate-700 leading-relaxed">
                        <li>Un Signal de Trading Externe est reçu par un Processeur de Signal.</li>
                        <li>Le signal traité informe les décisions au sein du Module d'Exécution d'Ordres MT5 (ordres de démonstration).</li>
                        <li>Toutes les données pertinentes (détails du signal, exécution d'ordres, P&L) sont capturées par le module de Journalisation & Stockage des Données.</li>
                        <li>Un module de Surveillance de Performance & Détecteur de Dérive analyse les données pour évaluer l'efficacité du modèle actuel et identifier une dérive potentielle.</li>
                        <li>Si un réentraînement est déclenché, le Module de Réentraînement Incrémental (utilisant CatBoost) met à jour le modèle existant.</li>
                        <li>Le Modèle Mis à Jour est déployé.</li>
                        <li>Les résultats et métriques forment une Boucle de Rétroaction, influençant les actions futures et fournissant des données pour les cycles de réentraînement.</li>
                    </ol>
                    <p class="mb-4 text-slate-700 leading-relaxed">
                        Les marchés financiers sont dynamiques et non stationnaires. La "dérive de concept" (changement des propriétés statistiques ou des relations entre caractéristiques et cible) rend les modèles statiques obsolètes. Un système adaptatif est une nécessité.
                    </p>
                    <p class="text-slate-700 leading-relaxed">
                        La modularité est un aspect critique, permettant des mises à jour indépendantes de chaque composant (source de signaux, algorithme de détection de dérive, modèle ML). Cela assure la viabilité à long terme et atténue la dette technique.
                    </p>
                </div>
            </section>

            <section id="key-modules" class="content-section">
                <div class="content-card">
                    <h3 class="subsection-title">2.2. Modules Clés et Leurs Interactions</h3>
                    <ul class="styled-list">
                        <li><strong>Ingestion & Traitement des Signaux :</strong> Point d'entrée des signaux de trading externes, validation et transformation.</li>
                        <li><strong>Module d'Interaction MT5 :</strong> Communication avec le terminal MT5 (connexion, envoi d'ordres de démo, récupération des résultats).</li>
                        <li><strong>Module de Journalisation & Gestion des Données :</strong> Stockage persistant des signaux, caractéristiques, ordres MT5, paramètres d'entraînement, métriques de performance, événements de dérive. Crucial pour l'analyse, l'audit et le réentraînement.</li>
                        <li><strong>Module d'Apprentissage Incrémental :</strong> Gère le modèle prédictif CatBoost, orchestre le réentraînement incrémental via <code>init_model</code> avec de nouvelles données.</li>
                        <li><strong>Module de Détection de Dérive :</strong> Surveille activement la dérive de concept en analysant les métriques de performance ou la distribution des données. Peut déclencher des alertes ou un réentraînement.</li>
                        <li><strong>Couche d'Automatisation & d'Orchestration :</strong> (Ex: Planificateur de tâches Windows) Gère l'exécution automatisée et coordonnée des modules (collecte de données, vérification de performance, réentraînement programmé).</li>
                        <li><strong>Mécanisme de Rétroaction :</strong> Boucle multifacette. Fournit des données étiquetées pour le réentraînement, peut ajuster les paramètres de risque, et déclenche des actions en cas de dégradation de performance ou de dérive.</li>
                    </ul>
                </div>
            </section>

            <section id="core-components" class="content-section page-break">
                <div class="content-card">
                    <h2 class="section-title">3. Composants Système Clés : Conception et Implémentation</h2>
                    <p class="mb-6 text-slate-700 leading-relaxed">Cette section détaille la conception et l'implémentation spécifiques des composants principaux du moteur d'auto-apprentissage.</p>
                </div>
            </section>

            <section id="mt5-interface" class="content-section">
                <div class="content-card">
                    <h3 class="subsection-title">3.1. Interface avec MetaTrader 5 (MT5) via Python</h3>
                    <p class="mb-4 text-slate-700 leading-relaxed">Le package officiel <code>MetaTrader5</code> pour Python permet une interface robuste avec le terminal MT5, principalement pour les environnements Windows.</p>

                    <h4 class="block-title">3.1.1. Établissement de la Connexion et Gestion de Session</h4>
                    <p class="mb-2 text-slate-700 leading-relaxed">Implique l'initialisation avec les identifiants de compte de démonstration et le serveur. Il est bon de journaliser les informations du terminal et du compte après la connexion.</p>
                    <div class="code-block">
                        <pre>
# Python 3.11
# -*- coding: utf-8 -*-
import MetaTrader5 as mt5
import os
from dotenv import load_dotenv # Utilisé pour charger les identifiants

load_dotenv() # Charger les variables d'environnement
ACCOUNT_LOGIN = int(os.getenv("MT5_LOGIN", 0))
ACCOUNT_PASSWORD = os.getenv("MT5_PASSWORD", "YOUR_DEMO_PASSWORD")
MT5_SERVER = os.getenv("MT5_SERVER", "YOUR_DEMO_SERVER")

# Initialisation de la connexion
if not mt5.initialize(login=ACCOUNT_LOGIN, server=MT5_SERVER, password=ACCOUNT_PASSWORD):
    print(f"initialize() a échoué, code d'erreur = {mt5.last_error()}")
    mt5.shutdown()
    quit()
print("Connecté à MT5 avec succès.")
# ... (afficher les infos du terminal et du compte) ...
                        </pre>
                    </div>

                    <h4 class="block-title">3.1.2. Exécution d'Ordres de Démonstration</h4>
                    <p class="mb-2 text-slate-700 leading-relaxed">Les ordres de démonstration sont placés avec <code>mt5.order_send()</code>, nécessitant un dictionnaire de paramètres (symbole, volume, type d'ordre, SL/TP). Le système doit construire ces requêtes dynamiquement.</p>
                    <div class="code-block">
                        <pre>
# Exemple d'envoi d'ordre d'achat
symbol = "EURUSD" # À rendre dynamique
lot = 0.01
# ... (vérifier la disponibilité du symbole) ...
point = mt5.symbol_info(symbol).point
price = mt5.symbol_info_tick(symbol).ask # Prix Ask pour un achat
request = {
    "action": mt5.TRADE_ACTION_DEAL,
    "symbol": symbol,
    "volume": lot,
    "type": mt5.ORDER_TYPE_BUY,
    "price": price,
    "sl": round(price - 100 * point, 5), # SL à 100 points (exemple)
    "tp": round(price + 100 * point, 5), # TP à 100 points (exemple)
    "deviation": 20,
    "magic": 234000,
    "comment": "Python auto-learning open",
    "type_time": mt5.ORDER_TIME_GTC,
    "type_filling": mt5.ORDER_FILLING_FOK,
}
result = mt5.order_send(request)
if result is None or result.retcode != mt5.TRADE_RETCODE_DONE:
    print(f"order_send a échoué, retcode={result.retcode if result else 'None'}, comment={result.comment if result else mt5.last_error()}")
else:
    print(f"Ordre placé avec succès, ticket={result.order}")
# Journaliser méticuleusement les résultats
                        </pre>
                    </div>
                     <p class="mt-2 text-slate-700 leading-relaxed">La vérification du <code>retcode</code> est cruciale. La journalisation des succès et échecs fournit des données sur la qualité d'exécution.</p>

                    <h4 class="block-title">3.1.3. Fermeture de la Connexion</h4>
                    <p class="mb-2 text-slate-700 leading-relaxed">Fermer proprement la connexion avec <code>mt5.shutdown()</code>.</p>
                    <div class="code-block">
                        <pre>
# mt5.shutdown() # À appeler à la fin des opérations
print("Connexion MT5 fermée (conceptuellement).")
                        </pre>
                    </div>
                    <p class="mt-2 text-slate-700 leading-relaxed">Une gestion robuste des erreurs est primordiale pour la résilience du système automatisé.</p>
                </div>
            </section>

            <section id="data-persistence" class="content-section page-break">
                <div class="content-card">
                    <h3 class="subsection-title">3.2. Persistance des Données : Journalisation des Signaux, Ordres et Performances</h3>
                    <h4 class="block-title">3.2.1. Logique d'une Journalisation Complète</h4>
                    <p class="mb-2 text-slate-700 leading-relaxed">La journalisation est la pierre angulaire du système adaptatif pour :</p>
                    <ul class="styled-list">
                        <li>Réentraînement Incrémental.</li>
                        <li>Surveillance de Performance et Détection de Dérive.</li>
                        <li>Rollback de Modèle.</li>
                        <li>Débogage et Audit.</li>
                    </ul>

                    <h4 class="block-title">3.2.2. Schéma de Base de Données SQLite</h4>
                    <p class="mb-2 text-slate-700 leading-relaxed">SQLite est adapté pour une application à nœud unique. Schéma proposé :</p>
                    <ul class="styled-list">
                        <li><strong>TradingSignals :</strong> <code>SignalID (PK)</code>, <code>TimestampUTC</code>, <code>Symbol</code>, <code>SignalType</code>, <code>SignalSource</code>, <code>Confidence</code>, <code>RawSignalData</code>, <code>ProcessedTimestampUTC</code>.</li>
                        <li><strong>MT5Orders :</strong> <code>OrderID (PK)</code>, <code>SignalID (FK)</code>, <code>OrderTimestampUTC</code>, <code>Symbol</code>, <code>OrderType</code>, <code>Volume</code>, <code>OpenPrice</code>, <code>SL</code>, <code>TP</code>, <code>ClosePrice</code>, <code>CloseTimestampUTC</code>, <code>ProfitLoss</code>, <code>Commission</code>, <code>Swap</code>, <code>MT5RetCode</code>, <code>MT5Comment</code>, <code>Status</code>.</li>
                        <li><strong>ModelTrainingLog :</strong> <code>TrainingLogID (PK)</code>, <code>ModelVersion (UNIQUE)</code>, <code>TrainingTimestampUTC</code>, <code>BaseModelVersion</code>, <code>NewDataSamplesCount</code>, <code>TrainingDurationSeconds</code>, <code>EvaluationMetrics (JSON)</code>, <code>CatBoostParameters (JSON)</code>, <code>Notes</code>.</li>
                        <li><strong>ModelPerformanceLog :</strong> <code>PerformanceLogID (PK)</code>, <code>ModelVersion (FK)</code>, <code>TimestampUTC</code>, <code>MetricName</code>, <code>MetricValue</code>, <code>DataWindowSize</code>, <code>DriftIndicatorJSON</code>.</li>
                        <li><strong>FeatureLog :</strong> <code>FeatureLogID (PK)</code>, <code>PredictionID (UNIQUE)</code>, <code>TimestampUTC</code>, <code>ModelVersion (FK)</code>, <code>FeaturesJSON</code>, <code>PredictedSignal</code>, <code>PredictionProbability</code>, <code>ActualOutcome</code>, <code>OutcomeTimestampUTC</code>, <code>OrderID (FK)</code>, <code>UsedForRetraining (BOOL)</code>.</li>
                    </ul>
                    <p class="mt-2 text-slate-700 leading-relaxed">Un indexage approprié est crucial. La gestion de la séparation temporelle entre prédiction et résultat dans <code>FeatureLog</code> est essentielle pour éviter le biais de regard en arrière.</p>
                    <p class="mt-4 text-slate-600 text-sm leading-relaxed">Le schéma détaillé (comme présenté dans le PDF original) permet une traçabilité complète, supporte le réentraînement, la surveillance et les décisions de rollback.</p>


                    <h4 class="block-title">3.2.3. Schéma CSV pour l'Échange de Données</h4>
                    <p class="mb-2 text-slate-700 leading-relaxed">Les fichiers CSV sont utiles pour l'échange de données ou l'analyse externe. Structure typique :</p>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr><th>Timestamp</th><th>Open</th><th>High</th><th>Low</th><th>Close</th><th>Volume</th><th>Indicator1...N</th><th>TargetSignal_Future</th><th>PredictedSignal_Current</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>2023-10-26T10:00:00Z</td><td>1.05123</td><td>1.05150</td><td>1.05100</td><td>1.05145</td><td>1200</td><td>...</td><td>BUY</td><td>BUY</td></tr>
                                 <tr><td>2023-10-26T10:01:00Z</td><td>1.05145</td><td>1.05160</td><td>1.05130</td><td>1.05135</td><td>1500</td><td>...</td><td>SELL</td><td>HOLD</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="incremental-learning" class="content-section page-break">
                <div class="content-card">
                    <h3 class="subsection-title">3.3. Réentraînement Incrémental du Modèle avec CatBoost</h3>
                    <h4 class="block-title">3.3.1. Introduction à l'Apprentissage Incrémental</h4>
                    <p class="mb-2 text-slate-700 leading-relaxed">Permet au modèle d'apprendre à partir de nouvelles données sans réentraînement complet. Avantages : adaptabilité, efficacité des ressources, pertinence maintenue. Défis : oubli catastrophique.</p>
                    
                    <h4 class="block-title">3.3.2. Paramètre <code>init_model</code> de CatBoost</h4>
                    <p class="mb-2 text-slate-700 leading-relaxed">CatBoost facilite l'apprentissage incrémental via <code>init_model</code>. La nouvelle session d'entraînement commence à partir de l'état du modèle initial. Supporté sur CPU uniquement. Le type de problème doit être cohérent.</p>

                    <h4 class="block-title">3.3.3. Étapes d'Implémentation</h4>
                    <ol class="list-decimal list-inside space-y-2 text-slate-700 leading-relaxed">
                        <li><strong>Charger le Modèle Existant :</strong> Depuis un fichier <code>.cbm</code>.</li>
                        <li><strong>Préparer les Nouvelles Données :</strong> Récupérer depuis <code>FeatureLog</code> (où <code>ActualOutcome</code> est renseigné et <code>UsedForRetraining=0</code>). Formater en <code>Pool</code> CatBoost.</li>
                        <li><strong>Effectuer l'Entraînement Incrémental :</strong> Appeler <code>fit()</code> sur une nouvelle instance (ou l'existante) avec <code>init_model=existing_model</code> et les nouvelles données.</li>
                        <li><strong>Sauvegarder le Modèle Mis à Jour :</strong> Avec un nouvel identifiant de version.</li>
                        <li><strong>Journaliser les Détails de l'Entraînement :</strong> Dans <code>ModelTrainingLog</code> et marquer les données comme utilisées dans <code>FeatureLog</code>.</li>
                    </ol>
                    <div class="code-block">
                        <pre>
# Python 3.11
# -*- coding: utf-8 -*-
from catboost import CatBoostClassifier, Pool
import pandas as pd
import sqlite3
from datetime import datetime
import json

# --- Chargement et préparation (conceptuel) ---
# existing_model = CatBoostClassifier().load_model("path/to/existing_model.cbm")
# conn = sqlite3.connect("path/to/db.sqlite")
# new_data_df = pd.read_sql_query("SELECT FeaturesJSON, ActualOutcome FROM FeatureLog WHERE ...", conn)
# new_X = pd.DataFrame([json.loads(x) for x in new_data_df['FeaturesJSON']])
# new_y = new_data_df['ActualOutcome'] 
# new_data_pool = Pool(data=new_X, label=new_y)

# --- Entraînement incrémental (conceptuel) ---
# if new_data_pool and existing_model:
#     updated_model = CatBoostClassifier(iterations=existing_model.get_param('iterations') + 50, ...)
#     updated_model.fit(new_data_pool, init_model=existing_model, verbose=0)
#     new_model_version = f"catboost_model_{datetime.now().strftime('%Y%m%d%H%M%S')}.cbm"
#     updated_model.save_model(f"path/to/models/{new_model_version}")
    # ... (journalisation dans ModelTrainingLog et FeatureLog) ...
# conn.close()
print("Exemple conceptuel de réentraînement incrémental avec CatBoost.")
                        </pre>
                    </div>
                     <h4 class="block-title">3.3.4. Considérations pour les Ensembles de Caractéristiques Évolutifs</h4>
                     <p class="text-slate-700 leading-relaxed"><code>init_model</code> est flexible aux changements de caractéristiques, mais des altérations drastiques peuvent nécessiter un réentraînement complet. La détection de dérive est cruciale ici.</p>
                </div>
            </section>

            <section id="automation-scheduler" class="content-section">
                <div class="content-card">
                    <h3 class="subsection-title">3.4. Automatisation du Cycle d'Apprentissage avec le Planificateur de Tâches Windows</h3>
                    <h4 class="block-title">3.4.1. Vue d'Ensemble du Planificateur de Tâches Windows</h4>
                    <p class="mb-2 text-slate-700 leading-relaxed">Composant natif de Windows pour planifier l'exécution de programmes ou scripts.</p>
                    <h4 class="block-title">3.4.2. Configuration d'une Tâche Planifiée pour le Pipeline Python</h4>
                    <p class="mb-2 text-slate-700 leading-relaxed">Implique la création d'une tâche spécifiant le chemin vers l'exécutable Python (de l'environnement virtuel), les arguments (chemin vers le script principal), et le répertoire de démarrage. L'utilisation d'un fichier batch (<code>.bat</code>) intermédiaire est souvent plus gérable.</p>
                    <div class="code-block">
                        <pre>
REM Fichier Batch (exemple : run_pipeline.bat)
@echo off
SET PYTHON_EXE="C:\chemin\vers\venv\Scripts\python.exe"
SET PYTHON_SCRIPT="C:\chemin\vers\projet\main_pipeline.py"
SET WORKING_DIR="C:\chemin\vers\projet\"
SET BATCH_LOG_FILE="%WORKING_DIR%logs\task_scheduler_run.log"

cd /D %WORKING_DIR%
echo Starting Python pipeline at %date% %time% >> %BATCH_LOG_FILE%
%PYTHON_EXE% %PYTHON_SCRIPT% >> %BATCH_LOG_FILE% 2>>&1
echo Finished with exit code %errorlevel% at %date% %time% >> %BATCH_LOG_FILE%
                        </pre>
                    </div>
                     <h4 class="block-title">3.4.3. Configuration pour la Robustesse</h4>
                     <p class="text-slate-700 leading-relaxed">Options de sécurité ("Exécuter même si l'utilisateur n'est pas connecté"), paramètres de redémarrage en cas d'échec, timeout. Une journalisation interne complète par le script Python est impérative pour le diagnostic.</p>
                </div>
            </section>

            <section id="adaptability-resilience" class="content-section page-break">
                <div class="content-card">
                    <h2 class="section-title">4. Assurer l'Adaptabilité et la Résilience du Modèle</h2>
                    <p class="mb-6 text-slate-700 leading-relaxed">Un principe fondamental du moteur d'auto-apprentissage est sa capacité à s'adapter au paysage en constante évolution des marchés financiers et à rester résilient face à la dégradation des performances du modèle ou aux défaillances du système.</p>
                </div>
            </section>

            <section id="concept-drift" class="content-section">
                <div class="content-card">
                    <h3 class="subsection-title">4.1. Détection et Réaction à la Dérive de Concept</h3>
                    <h4 class="block-title">4.1.1. Nature de la Dérive de Concept sur les Marchés Financiers</h4>
                    <p class="mb-2 text-slate-700 leading-relaxed">La dérive de concept se réfère au changement des propriétés statistiques de la variable cible ou de la relation sous-jacente entre les caractéristiques d'entrée et la variable cible au fil du temps. Causes : conditions macroéconomiques évolutives, changements de microstructure du marché, comportement des participants, événements mondiaux imprévus. Types : soudaine, graduelle, incrémentale, récurrente.</p>
                
                    <h4 class="block-title">4.1.2. Vue d'Ensemble des Méthodes de Détection de Dérive (DDM)</h4>
                    <p class="mb-2 text-slate-700 leading-relaxed">Les DDM identifient quand une dérive de concept se produit. Approches courantes :</p>
                    <ul class="styled-list">
                        <li><strong>Surveillance de l'Erreur du Modèle :</strong> DDM, EDDM, HDDM (basées sur le contrôle statistique des processus).</li>
                        <li><strong>Méthodes Basées sur Fenêtre :</strong> ADWIN (fenêtrage adaptatif), KSWIN (test de Kolmogorov-Smirnov).</li>
                        <li><strong>Comparaison de Lots :</strong> Test KS, Indice de Stabilité de la Population (PSI).</li>
                    </ul>
                    <p class="mt-2 text-slate-700 leading-relaxed">Pour un moteur continu, les détecteurs de streaming sont plus appropriés.</p>
                    <div class="table-container mt-4">
                        <table>
                            <thead>
                                <tr><th>Méthode</th><th>Type</th><th>Données d'Entrée</th><th>Avantages</th><th>Inconvénients</th><th>Cas d'Usage Trading</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>DDM</td><td>Streaming/SPC</td><td>Erreur prédiction (0/1)</td><td>Simple, efficace (dérive soudaine)</td><td>Sensible bruit, peut rater dérive graduelle</td><td>Surveillance précision classification</td></tr>
                                <tr><td>ADWIN</td><td>Streaming/Fenêtre</td><td>Flux numérique (erreur, caract.)</td><td>Adaptatif, robuste (dérive graduelle)</td><td>Plus coûteux, usage mémoire</td><td>Surveillance taux erreur, stabilité caract.</td></tr>
                                <tr><td>KSWIN</td><td>Streaming/Fenêtre (Test KS)</td><td>Flux numérique (valeurs caract.)</td><td>Non paramétrique, compare distributions</td><td>Sensible taille fenêtre</td><td>Surveillance distribution caract. critiques (volatilité)</td></tr>
                            </tbody>
                        </table>
                    </div>


                    <h4 class="block-title">4.1.3. Implémentation de la Détection de Dérive avec Frouros</h4>
                    <p class="mb-2 text-slate-700 leading-relaxed">Des bibliothèques Python comme Frouros ou River offrent des implémentations. Frouros est complet pour la dérive de concept et de données.</p>
                    <div class="code-block">
                        <pre>
# Python 3.11
# -*- coding: utf-8 -*-
# Conceptuel - Utilisation de DDM de Frouros
from frouros.detectors.concept_drift import DDM, DDMConfig
import numpy as np
import sqlite3 # Pour journaliser la détection
from datetime import datetime
import json

# ddm_config = DDMConfig(warning_level=2.0, drift_level=3.0, min_num_instances=30)
# ddm_detector = DDM(config=ddm_config)
# simulated_errors = np.concatenate([np.zeros(50), np.random.choice([0,1], size=50, p=[0.7,0.3])])

# print("Surveillance du flux d'erreurs simulé...")
# for i, error_value in enumerate(simulated_errors):
#     ddm_detector.update(value=error_value)
#     if ddm_detector.status['drift']:
#         print(f"Dérive DÉTECTÉE à l'échantillon {i}!")
        # Logique pour journaliser dans ModelPerformanceLog
        # ...
#         break
#     elif ddm_detector.status['warning']:
#         print(f"Avertissement de dérive à l'échantillon {i}.")
print("Exemple conceptuel de détection de dérive avec Frouros DDM.")
                        </pre>
                    </div>
                    <h4 class="block-title">4.1.4. Stratégies de Réaction</h4>
                    <p class="text-slate-700 leading-relaxed">Sur détection de dérive : réentraînement incrémental (principal), réentraînement complet (dérive sévère), passage à un modèle de repli, alerte superviseur humain, ajustement des paramètres système (risque).</p>
                    <p class="mt-2 text-slate-700 leading-relaxed">Il est crucial de surveiller à la fois l'erreur du modèle (P(Y|X)) et la dérive des données d'entrée (P(X)) pour des avertissements précoces.</p>
                </div>
            </section>

            <section id="model-rollback" class="content-section">
                <div class="content-card">
                    <h3 class="subsection-title">4.2. Implémentation d'une Stratégie de Rollback de Modèle</h3>
                    <h4 class="block-title">4.2.1. Logique et Déclencheurs du Rollback</h4>
                    <p class="mb-2 text-slate-700 leading-relaxed">Mécanisme de sécurité pour revenir à une version précédente stable si un nouveau modèle sous-performe. Déclencheurs : dégradation significative des performances, échec catastrophique du modèle, adaptation à la dérive ingérable, introduction de bogues.</p>
                
                    <h4 class="block-title">4.2.2. Processus de Rollback</h4>
                    <ol class="list-decimal list-inside space-y-1 text-slate-700 leading-relaxed">
                        <li><strong>Versionnement des Modèles :</strong> Chaque modèle entraîné est sauvegardé avec un identifiant unique.</li>
                        <li><strong>Identification de la "Dernière Bonne Version Connue" :</strong> Via requête sur <code>ModelPerformanceLog</code> et <code>ModelTrainingLog</code>.</li>
                        <li><strong>Mécanisme de Rollback :</strong> Mise à jour d'un pointeur central (fichier texte, table DB) indiquant le modèle actif.</li>
                        <li><strong>Journalisation de l'Événement de Rollback.</strong></li>
                    </ol>

                    <h4 class="block-title">4.2.3. Logique Python pour le Rollback (Conceptuel)</h4>
                     <p class="mb-2 text-slate-700 leading-relaxed">Nécessite un composant de surveillance évaluant continuellement la santé du modèle déployé.</p>
                    <div class="code-block">
                        <pre>
# Python 3.11
# -*- coding: utf-8 -*-
# Conceptuel - Logique de vérification de performance et rollback
import sqlite3
from datetime import datetime, timedelta
import json # Pour parser les métriques stockées en JSON

DB_PATH = "path/to/db.sqlite"
MODEL_POINTER_FILE = "path/to/current_model_pointer.txt"
# PERFORMANCE_THRESHOLD_METRIC = "Accuracy"
# MIN_PERFORMANCE_THRESHOLD = 0.55

def get_current_model_path_from_pointer():
    try:
        with open(MODEL_POINTER_FILE, 'r') as f: return f.read().strip()
    except FileNotFoundError: return None

def update_model_pointer_file(new_model_path):
    with open(MODEL_POINTER_FILE, 'w') as f: f.write(new_model_path)
    print(f"Pointeur de modèle mis à jour vers: {new_model_path}")
    # ... (logique de journalisation du rollback) ...

# def check_performance_and_rollback():
    # current_model_path = get_current_model_path_from_pointer()
    # ... (connexion DB, requête sur ModelPerformanceLog pour le modèle actuel) ...
    # avg_performance = ... ; sample_count = ...
    # if sample_count >= MIN_SAMPLES_FOR_EVAL and avg_performance < MIN_PERFORMANCE_THRESHOLD:
    #     print("Performance dégradée, déclenchement du rollback.")
        # ... (logique pour trouver la meilleure version alternative depuis ModelTrainingLog/ModelPerformanceLog) ...
        # best_alternative_path = "path/to/models/best_alternative.cbm" 
        # if best_alternative_path:
        #     update_model_pointer_file(best_alternative_path)
        # else:
        #     print("Aucune version de rollback appropriée trouvée.")
    # ... (fermer connexion DB) ...
print("Exemple conceptuel de logique de rollback.")
                        </pre>
                    </div>
                    <p class="mt-2 text-slate-700 leading-relaxed">Une stratégie de rollback efficace devrait idéalement versionner également les pipelines de données et d'ingénierie des caractéristiques associés à chaque version de modèle.</p>
                </div>
            </section>

            <section id="performance-analysis-gpu" class="content-section page-break">
                <div class="content-card">
                    <h2 class="section-title">5. Analyse de Performance : CatBoost sur GPU (RTX 3060) vs. CPU</h2>
                    <h4 class="block-title">5.1. Capacités d'Entraînement GPU de CatBoost</h4>
                    <p class="mb-2 text-slate-700 leading-relaxed">CatBoost supporte l'accélération GPU NVIDIA, réduisant le temps d'entraînement, surtout pour les grands datasets.</p>
                
                    <h4 class="block-title">5.2. Considérations de Benchmarking</h4>
                    <p class="mb-2 text-slate-700 leading-relaxed">L'accélération GPU dépend de : taille du dataset (plus grand = meilleur speedup), nombre d'itérations, complexité des arbres, nombre de bins, mémoire GPU (RTX 3060 a typiquement 12Go).</p>

                    <h4 class="block-title">5.3. RTX 3060 vs. CPU : Performance Attendue</h4>
                    <p class="mb-2 text-slate-700 leading-relaxed">Des benchmarks sur des GPU plus anciens montrent des speedups de 3x à 15x+. La RTX 3060 (Ampere) est plus puissante. <strong>Caveat Crucial :</strong> <code>init_model</code> pour l'apprentissage incrémental est supporté sur CPU uniquement. Le GPU bénéficiera à l'entraînement initial complet et aux réentraînements complets périodiques.</p>
                    <div class="table-container mt-4">
                        <table>
                            <thead>
                                <tr><th>Scénario</th><th>Taille Dataset (Ex.)</th><th>Temps Entr. CPU (Est.)</th><th>Temps Entr. RTX 3060 (Est.)</th><th>Speedup (Est.)</th><th>Notes</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>Entraînement Initial Complet</td><td>Moyen (1M lignes)</td><td>Dizaines de Min - H</td><td>Minutes</td><td>5-15x</td><td>Speedup significatif</td></tr>
                                <tr><td>Mise à Jour Incrémentale (init_model)</td><td>Petit Incrément (10k lignes)</td><td>Secondes - Min</td><td>Secondes - Min</td><td>~1x (CPU)</td><td><code>init_model</code> est CPU-only</td></tr>
                            </tbody>
                        </table>
                    </div>


                    <h4 class="block-title">5.4. Implications Pratiques pour le Moteur d'Auto-Apprentissage</h4>
                    <p class="text-slate-700 leading-relaxed">Le GPU est sous-utilisé pour les mises à jour incrémentales fréquentes. Valeur principale pour l'entraînement initial complexe et les réentraînements complets (dérive sévère, planifiés). Une politique est nécessaire : mises à jour incrémentales par défaut (CPU), réentraînement complet sur GPU pour dérive majeure ou planifié.</p>
                </div>
            </section>

            <section id="conclusion-engine" class="content-section page-break">
                <div class="content-card">
                    <h2 class="section-title">6. Conclusion et Perspectives</h2>
                    <h4 class="block-title">6.1. Résumé du Moteur d'Auto-Apprentissage</h4>
                    <p class="mb-2 text-slate-700 leading-relaxed">Ce document a détaillé la conception d'un moteur d'auto-apprentissage adaptatif pour le trading algorithmique sur MT5, mettant l'accent sur une boucle de rétroaction continue, la journalisation des données, le réentraînement incrémental avec CatBoost, l'automatisation, la détection de dérive et le rollback de modèle.</p>
                
                    <h4 class="block-title">6.2. Limitations et Considérations</h4>
                    <p class="mb-2 text-slate-700 leading-relaxed">Qualité du signal d'entrée fondamentale, complexité du système, ressources computationnelles, risque de surajustement, complexité du backtesting d'un système adaptatif, écarts démo vs. réel.</p>

                    <h4 class="block-title">6.3. Améliorations Futures Potentielles</h4>
                    <ul class="styled-list">
                        <li>Adaptation à la dérive plus sophistiquée.</li>
                        <li>Composants d'Apprentissage par Renforcement pour optimiser les hyper-paramètres du système.</li>
                        <li>Intégration de données alternatives.</li>
                        <li>Pratiques MLOps avancées (A/B testing, versionnement de schéma DB, lignée de données).</li>
                        <li>Apprentissage décrémental ("désapprendre").</li>
                        <li>Exploration de nouveaux modèles adaptatifs (FLAIR, TabPFN v2).</li>
                        <li>Amélioration de l'Expliquabilité (XAI).</li>
                    </ul>
                </div>
            </section>

            <section id="references-engine" class="content-section page-break">
                <div class="content-card">
                    <h2 class="section-title">7. Références</h2>
                    <p class="mb-4 text-slate-700 leading-relaxed">Ce rapport s'appuie sur les concepts et les outils décrits dans les documents suivants (liste non exhaustive, se référer au PDF original pour la liste complète) :</p>
                    <ul class="styled-list space-y-1 text-sm">
                        <li>Documentation CatBoost (<code>init_model</code>, entraînement GPU).</li>
                        <li>Documentation MetaTrader 5 Python package.</li>
                        <li>Documentation Frouros (détecteurs de dérive comme DDM, ADWIN).</li>
                        <li>Articles sur l'apprentissage incrémental, la dérive de concept, et les boucles de rétroaction en IA.</li>
                        <li>Guides sur l'automatisation avec le Planificateur de Tâches Windows.</li>
                        <li>Bonnes pratiques MLOps (versionnement, rollback, suivi d'expériences).</li>
                    </ul>
                     <p class="mt-4 text-slate-600 text-sm leading-relaxed"><em>Pour une liste complète et détaillée des références, veuillez consulter le document PDF "MT5 Auto-Learning Engine Design.pdf" original.</em></p>
                </div>
            </section>

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const navLinks = document.querySelectorAll('.nav-link');
            const contentSections = document.querySelectorAll('.content-section');
            const reportNavigation = document.getElementById('report-navigation');
            
            function showSection(targetId) {
                contentSections.forEach(section => {
                    section.classList.toggle('active', section.id === targetId);
                });
            }
            
            function updateActiveLink(targetId) {
                 navLinks.forEach(navLink => {
                    navLink.classList.toggle('active', navLink.dataset.target === targetId);
                });
            }

            navLinks.forEach(link => {
                link.addEventListener('click', function (event) {
                    event.preventDefault();
                    const targetId = this.dataset.target;
                    
                    history.pushState(null, null, '#' + targetId); 
                    showSection(targetId);
                    updateActiveLink(targetId);
                    
                    const linkRect = this.getBoundingClientRect();
                    const navRect = reportNavigation.getBoundingClientRect();
                    if (linkRect.bottom > navRect.bottom || linkRect.top < navRect.top) {
                         this.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                     document.querySelector('main').scrollTop = 0; 
                });
            });
            
            function loadSectionFromHash() {
                let initialTargetId = 'executive-summary'; // Section par défaut pour ce rapport
                if (window.location.hash) {
                    const hashTarget = window.location.hash.substring(1);
                    const targetElement = document.getElementById(hashTarget);
                    if (targetElement && targetElement.classList.contains('content-section')) {
                        initialTargetId = hashTarget;
                    }
                }
                showSection(initialTargetId);
                updateActiveLink(initialTargetId);
                const activeLink = reportNavigation.querySelector('.nav-link.active');
                if (activeLink) {
                    const linkRect = activeLink.getBoundingClientRect();
                    const navRect = reportNavigation.getBoundingClientRect();
                     if (linkRect.bottom > navRect.bottom || linkRect.top < navRect.top) {
                        activeLink.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            }

            loadSectionFromHash();
            window.addEventListener('hashchange', loadSectionFromHash);
        });
    </script>
</body>
</html>
